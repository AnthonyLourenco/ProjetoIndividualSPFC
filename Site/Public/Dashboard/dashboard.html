<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>São Paulo | Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@200..800&display=swap" rel="stylesheet">
  <link rel="icon" href="../Assets/Imgs/iconSPFC.png" />
  <link rel="stylesheet" href="../css/styleDash.css" />
</head>
<body>
    <header>
        <div class="header" id="header">
            <span class="imagemIndex">
                <img src="../Assets/Imgs/São_Paulo_Futebol_Clube.png" class="imagemIndex" onclick="scrollToSection(0)">
            </span>
            <div class="navBar">
                <a href="../index.html#home" class="linkHome">
                    <span class="home" id="home">Sobre</span>
                </a>
                <a href="../index.html#home" class="linkHistorias">
                    <span class="historias" id="historias">Histórias</span>
                </a>
                <a href="../index.html#footer" class="linkContato">
                    <span class="contato" id="contato">Contato</span>
                </a>
            </div>
            <p class="nomeUsuarioDash">
              Bem Vindo, 
              <br>
              <span id="b_usuario">Usuário</span> !
            </p>
        </div>
    </header>
    <main class="main-container">
      <div class="main-title">
        <h2 class="tituloDashboard">RANKING</h2>
      </div>
      <div class="charts">
        <div class="charts-card">
          <h2 class="chart-title">Melhores Pontuações</h2>
          <div id="bar-chart"></div>
        </div>
        <div class="indicadores">
          <h2 class="chart-title">Indicadores</h2>
          <br><br><br>
          <div class="indicadoresContainer">
            <div class="indicador">
              <p>Contas Cadastradas</p>
              <p id="usuarios-count">0</p>
            </div>
            <div class="indicador"></div>
          </div>
          <br><br><br>
          <div class="indicadoresContainer">
            <div class="indicador"></div>
            <div class="indicador"></div>
          </div>
        </div>
      </div>
    </main>
    <!-- End Main -->
  </div>

  <!-- Scripts -->
  <!-- ApexCharts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/apexcharts/3.35.5/apexcharts.min.js"></script>
</body>

</html>

<script>
  b_usuario.innerHTML = sessionStorage.NOME_USUARIO;
  // SIDEBAR TOGGLE

  let sidebarOpen = false;
  const sidebar = document.getElementById("sidebar");

  function openSidebar() {
    if (!sidebarOpen) {
      sidebar.classList.add("sidebar-responsive");
      sidebarOpen = true;
    }
  }

  function closeSidebar() {
    if (sidebarOpen) {
      sidebar.classList.remove("sidebar-responsive");
      sidebarOpen = false;
    }
  }

  function updateUsuariosCount() {
    fetch("/usuarios/contar")
      .then((response) => response.json())
      .then((data) => {
        const usuariosCountElement = document.getElementById("usuarios-count");
        usuariosCountElement.textContent = data[0].totalUsuarios;
      })
      .catch((error) =>
        console.error("Erro ao buscar o número de usuários:", error)
      );
  }

  function updateTop5Pontuacao() {
    fetch("/medidas/top-5-pontuacao")
      .then((response) => {
        if (!response.ok) {
          throw new Error("Network response was not ok " + response.statusText);
        }
        return response.json();
      })
      .then((data) => {
        console.log("Dados recebidos:", data);
        if (!Array.isArray(data)) {
          throw new Error("Dados recebidos não são um array");
        }

        // Mapear os dados recebidos para as séries de dados e categorias
        const seriesData = data.map(item => item.pontuacao);
        const categories = data.map(item => item.nome);

        // BAR CHART 1

        console.log("serial:" + seriesData)
        const barChartOptions = {
          series: [
            {
              data: seriesData,
              name: "Pontos",
            },
          ],
          chart: {
            type: "bar",
            background: "transparent",
            height: 440,
            toolbar: {
              show: false,
            },
          },
          colors: ["#FFF"],
          plotOptions: {
            bar: {
              distributed: true,
              borderRadius: 4,
              horizontal: false,
              columnWidth: "40%",
            },
          },
          dataLabels: {
            enabled: false,
          },
          fill: {
            opacity: 1,
          },
          grid: {
            borderColor: "#FFF",
            yaxis: {
              lines: {
                show: true,
              },
            },
            xaxis: {
              lines: {
                show: true,
              },
            },
          },
          legend: {
            labels: {
              colors: "#FFF",
            },
            show: true,
            position: "top",
          },
          stroke: {
            colors: ["transparent"],
            show: true,
            width: 2,
          },
          tooltip: {
            shared: true,
            intersect: false,
            theme: "dark",
          },
          xaxis: {
            categories: categories,
            title: {
              style: {
                color: "#FFF",
              },
            },
            axisBorder: {
              show: true,
              color: "#FFF",
            },
            axisTicks: {
              show: true,
              color: "#FFF",
            },
            labels: {
              style: {
                colors: "#FFF",
              },
            },
          },
          yaxis: {
            title: {
              text: "Pontos",
              style: {
                color: "#FFF",
              },
            },
            axisBorder: {
              color: "#FFF",
              show: true,
            },
            axisTicks: {
              color: "#FFF",
              show: true,
            },
            labels: {
              style: {
                colors: "#FFF",
              },
            },
          },
        };

        const barChart = new ApexCharts(
          document.querySelector("#bar-chart"),
          barChartOptions
        );
        barChart.render();
      })
      .catch((error) => console.error("Erro ao buscar o top 5 de pontuação:", error));
  }
  // Chamar a função ao carregar a página
  
  document.addEventListener("DOMContentLoaded", updateUsuariosCount);
  document.addEventListener("DOMContentLoaded", updateTop5Pontuacao);

</script>